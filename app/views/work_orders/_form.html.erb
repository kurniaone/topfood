<%= form_for @order, as: 'order', :html => {:class => "form order-form"} do |f| %>
  <%= error_messages(@order).html_safe %>

  <div class="group">
    <% onumber = @order.order_number.blank? ? @order.generate_order_number : @order.order_number %>
    <%= f.label :order_number, 'Order Number', :class => 'label' %>
    <%= f.text_field :order_number, :class => 'text_field short', :readonly => "readonly", :value => onumber %>
  </div>
  <div class="group">
    <%= f.label :order_date, 'Order Date', :class => 'label' %>
    <% v = !@order.order_date.blank? ? @order.order_date.strftime("%d-%m-%Y") : '' %>
    <%= f.text_field :order_date, :class => 'text_field datepicker now', :value => v, :readonly => true %>
  </div>
  <div class="group">
    <%= f.label :created_by, 'Ordered by', :class => 'label' %>
    <%= f.label current_user.name, :class => 'label' %>
    <%= f.hidden_field :created_by, :value => current_user.id %>
  </div>
  <% if current_user.role?('sm') %>
    <div class="group">
      <%= f.label :branch_id, 'Branch', :class => 'label' %>
      <%= f.label current_user.branch.name, :class => 'label' %>
      <%= f.hidden_field :branch_id, :value => current_user.branch.try(:id) %>
    </div>
  <% end %>

  <table class="table" id="order_details">
    <tr>
      <th>Description</th>
      <th class="center">Quantity</th>
      <th class="center">Unit</th>
      <th class="right">Used date</th>
      <th></th>
    </tr>
    <%= f.fields_for :order_details do |od| %>
      <%= render :partial => 'order_detail_fields', :locals => { :f => od } %>
    <% end %>
  </table>
  <p><%= link_to_add_items "Add Order Item", f, :order_details %></p>

  <div class="actions-bar wat-cf">
    <%= f.submit "Send", :class => 'link-button right' %>
    <%= link_to "Back", work_orders_path, :class => 'link-button right' %>
    <div class="clear"></div>
  </div>
<% end %>